/* Minimal, print-friendly theme for Pandoc HTML */
:root {
    --font-body: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
    --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --color-fg: #24292f;
    --color-muted: #57606a;
    --color-bg: #ffffff;
    --color-border: #d0d7de;
    --color-accent: #0969da;
    --table-header-bg: #f6f8fa;
    --code-bg: #f6f8fa;
    --math-color: #30363d;
    --math-scale: 0.9;
    /* PRINT DENSITY SETTINGS (adjust these to control PDF compactness) */
    --print-base-size: 8.5pt;
    /* Base body font-size when printing */
    --print-line-height: 1.35;
    /* Line height for body text when printing */
    --print-page-padding-block: 8mm;
    /* Top/bottom page padding */
    --print-page-padding-inline: 10mm;
    /* Left/right page padding */
    --print-heading-scale-h1: 1.55;
    /* h1 size multiplier (relative to 1rem) */
    --print-heading-scale-h2: 1.3;
    --print-heading-scale-h3: 1.15;
    --print-heading-scale-h4: 1.05;
    --print-heading-scale-h5: 1.0;
    --print-heading-scale-h6: 0.9;
    --print-block-spacing: 0.65em;
    /* Vertical spacing for paragraphs/lists */
    --print-table-font-scale: 0.88;
    /* Table font-size multiplier */
    --print-table-cell-padding-y: 4px;
    /* Table cell vertical padding */
    --print-table-cell-padding-x: 6px;
    /* Table cell horizontal padding */
    --print-code-font-scale: 0.9;
    /* Code/pre font scaling */
    --print-math-scale: 0.8;
    /* Math formula scaling */
}

html {
    background: var(--color-bg);
    color: var(--color-fg);
}

body {
    font-family: var(--font-body);
    font-size: 15px !important;
    line-height: 1.6;
    margin: 0 auto;
    max-width: 900px;
    padding: 32px 24px;
    counter-reset: h2 h3;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    line-height: 1.25;
    margin: 1.2em 0 0.6em;
}

h1 {
    font-size: 1.875rem;
    counter-reset: h2 h3;
}

h2 {
    font-size: 1.5rem;
    counter-increment: h2;
    counter-reset: h3;
    /* add ~one extra line of space before h2 */
    margin-top: calc(1.2em + 1em);
}

h3 {
    font-size: 1.25rem;
    counter-increment: h3;
}

h2::before {
    content: counter(h2) " ";
}

h3::before {
    content: counter(h2) "." counter(h3) " ";
}

/* Ensure Pandoc section wrappers also reset sub-counters */
section.level1 {
    counter-reset: h2 h3;
}

section.level2 {
    counter-reset: h3;
}

h4 {
    font-size: 1.125rem;
}

h5 {
    font-size: 1rem;
}

h6 {
    font-size: 0.95rem;
    color: var(--color-muted);
}

p {
    margin: 0.8em 0;
}

ul,
ol {
    margin: 0.8em 0 0.8em 1.5em;
}

li>ul,
li>ol {
    margin-top: 0.4em;
}

a {
    color: var(--color-accent);
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

img,
svg {
    max-width: 100%;
    height: auto;
    /* Limit diagram height to prevent spanning multiple pages */
    max-height: 85vh;
    /* In print: limit to ~150% of page width or reasonable page height */
}

/* List items containing inline math: add breathing room between bullets */
li:has(.katex:not(.katex-display)),
li:has(.mjx-container:not([display="true"])),
li:has(.math.inline) {
    margin-top: 0.7em;
    margin-bottom: 0.7em;
    line-height: 1.5;
    line-height: 1.7;
}

/* MathJax SVG output tweaks: lighter appearance */
.mjx-svg {
    text-rendering: optimizeLegibility;
    shape-rendering: geometricPrecision;
}

.mjx-container[jax="SVG"] svg {
    overflow: visible;
}

.mjx-container[jax="SVG"] {
    direction: ltr;
    color: var(--math-color);
    font-size: calc(1em * var(--math-scale));
}

.mjx-char {
    shape-rendering: geometricPrecision;
}

.mjx-container[jax="SVG"] path {
    vector-effect: non-scaling-stroke;
}

/* Prevent gaps in extensible delimiters */
.mjx-container {
    line-height: 0 !important;
}

.mjx-container mjx-math {
    line-height: normal;
}

/* Inline math spacing: allow more breathing room in text lines */
.katex:not(.katex-display) {
    line-height: 1.7 !important;
    padding-top: 0.04em;
    padding-bottom: 0.04em;
}

.mjx-container:not([display="true"]) {
    line-height: 1.7 !important;
    padding-top: 0.04em;
    padding-bottom: 0.04em;
}

/* Do not alter display math spacing */
.katex-display,
.katex-display .katex {
    line-height: normal !important;
}

.math.inline {
    line-height: 1.7 !important;
    padding-top: 0.04em;
    padding-bottom: 0.04em;
}

/* Math weight adjustments (reduce perceived boldness) */
/* KaTeX HTML output */
.katex,
.katex * {
    font-weight: 400 !important;
}

.katex .textbf,
.katex .mathbf {
    font-weight: 600 !important;
}

/* MathJax CHTML output */
.mjx-container[jax="CHTML"] {
    font-weight: 400 !important;
}

.mjx-container[jax="CHTML"] .MJX-B,
.mjx-container[jax="CHTML"] .mjx-bold {
    font-weight: 600 !important;
}

/* MathJax SVG output: slightly reduce opacity to appear lighter */
.mjx-container[jax="SVG"] {
    opacity: 0.92;
}

figure {
    margin: 1em 0;
}

figcaption {
    color: var(--color-muted);
    font-size: 0.9em;
    text-align: center;
}

blockquote {
    margin: 1em 0;
    padding: 0.6em 1em;
    border-left: 4px solid var(--color-border);
    color: var(--color-muted);
    background: #fafbfc;
}

code,
kbd,
samp {
    font-family: var(--font-mono);
    font-size: 0.95em;
}

pre {
    background: var(--code-bg);
    padding: 12px 14px;
    overflow: auto;
    border: 1px solid var(--color-border);
    border-radius: 6px;
}

pre code {
    background: transparent;
    padding: 0;
}

table {
    border-collapse: collapse;
    width: 100%;
    font-variant-numeric: tabular-nums;
    font-size: 0.94em;
}

th,
td {
    border: 1px solid var(--color-border);
    padding: 6px 8px;
    vertical-align: top;
}

thead th {
    background: var(--table-header-bg);
    text-align: left;
}

tbody tr:nth-child(even) {
    background: #fcfcfd;
}

hr {
    border: 0;
    border-top: 1px solid var(--color-border);
    margin: 1.5em 0;
}

/* Math block spacing */
.math.display {
    display: block;
    margin: 1em 0;
}

/* TOC page break */
nav#TOC,
#TOC,
.toc {
    break-before: page;
    page-break-before: always;
}

/* Print adjustments */
@media print {
    body {
        padding: var(--print-page-padding-block) var(--print-page-padding-inline);
        font-size: var(--print-base-size) !important;
        line-height: var(--print-line-height);
    }

    a {
        color: inherit;
        text-decoration: none;
    }

    /* Reduce widow/orphan lines for paragraphs */
    p {
        widows: 3;
        orphans: 3;
        margin: var(--print-block-spacing) 0;
    }

    /* Prefer smart breaks instead of always forcing new pages */
    h1,
    h2 {
        break-before: auto;
        page-break-before: auto;
    }

    /* Defer to smart heading rules; don't force page before sections */
    section.level1,
    section.level2 {
        break-before: auto;
        page-break-before: auto;
    }

    /* Avoid breaking immediately after any heading (keep it with first block) */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        break-after: avoid;
        page-break-after: avoid;
        margin: 0.9em 0 0.45em;
    }

    h1 {
        font-size: calc(var(--print-heading-scale-h1) * 1rem);
    }

    h2 {
        font-size: calc(var(--print-heading-scale-h2) * 1rem);
    }

    h3 {
        font-size: calc(var(--print-heading-scale-h3) * 1rem);
    }

    h4 {
        font-size: calc(var(--print-heading-scale-h4) * 1rem);
    }

    h5 {
        font-size: calc(var(--print-heading-scale-h5) * 1rem);
    }

    h6 {
        font-size: calc(var(--print-heading-scale-h6) * 1rem);
    }

    /* Extra spacing before h2 in print (~one extra line) */
    h2 {
        margin-top: calc(0.9em + 1em);
    }

    ul,
    ol {
        margin: var(--print-block-spacing) 0 var(--print-block-spacing) 1.4em;
    }

    table {
        font-size: calc(var(--print-table-font-scale) * 1em);
    }

    th,
    td {
        padding: var(--print-table-cell-padding-y) var(--print-table-cell-padding-x);
    }

    pre {
        font-size: calc(var(--print-code-font-scale) * 1em);
        padding: 8px 10px;
    }

    code,
    kbd,
    samp {
        font-size: calc(var(--print-code-font-scale) * 0.95em);
    }

    :root {
        --math-scale: var(--print-math-scale);
    }

    /* Keep common block elements intact on a page when possible */
    pre,
    blockquote,
    table,
    figure,
    img,
    svg,
    ul,
    ol,
    li,
    .sourceCode,
    .math.display {
        break-inside: avoid;
        page-break-inside: avoid;
    }

    /* Limit diagram height in print to prevent spanning multiple pages */
    img,
    svg {
        max-height: 85vh;
        /* Roughly 85% of viewport height */
        /* Alternative: limit to ~150% of page width */
        max-height: min(85vh, 135mm);
        /* 135mm ≈ 150% of typical page width */
    }

    /* Rows shouldn't break individually */
    tr {
        break-inside: avoid;
        page-break-inside: avoid;
        page-break-after: auto;
    }

    /* Repeat table headers/footers when a table spans pages */
    thead {
        display: table-header-group;
    }

    tfoot {
        display: table-footer-group;
    }
}

/* Print-only: center first H1 (and direct text after) on page 1 */
@media print {

    /* Horizontally center the title and its immediate paragraph */
    body>h1:first-of-type,
    section.level1:first-of-type>h1:first-of-type,
    body>h1:first-of-type+p,
    section.level1:first-of-type>h1:first-of-type+p {
        text-align: center;
    }

    /* Approximate vertical centering by pushing title down the page */
    body>h1:first-of-type,
    section.level1:first-of-type>h1:first-of-type {
        margin-top: 35vh;
    }

    /* Keep the lead paragraph close to the title */
    body>h1:first-of-type+p,
    section.level1:first-of-type>h1:first-of-type+p {
        margin-top: 0.6em;
    }

    /* Cancel older break-after trick; rely on first H2 break instead */
    body>h1:first-of-type+p::after,
    section.level1:first-of-type>h1:first-of-type+p::after {
        content: none;
        display: none;
        break-after: auto;
        page-break-after: auto;
    }

    /* Move FIRST H2 to the next page to make a proper title page */
    body>h1:first-of-type~h2:first-of-type,
    section.level1:first-of-type>h1:first-of-type~h2:first-of-type {
        break-before: page;
        page-break-before: always;
    }

    /* If a TOC exists right after the title, start it on a new page */
    body>h1:first-of-type~nav#TOC,
    body>h1:first-of-type~#TOC,
    body>h1:first-of-type~.toc,
    section.level1:first-of-type>h1:first-of-type~nav#TOC,
    section.level1:first-of-type>h1:first-of-type~#TOC,
    section.level1:first-of-type>h1:first-of-type~.toc {
        break-before: page;
        page-break-before: always;
    }

    /* Keep typical intro blocks intact on the title page */
    body>h1:first-of-type~pre,
    body>h1:first-of-type~table,
    body>h1:first-of-type~figure,
    body>h1:first-of-type~.math.display,
    body>h1:first-of-type~.katex-display,
    body>h1:first-of-type~.mjx-container[display="true"],
    body>h1:first-of-type~p,
    body>h1:first-of-type~ul,
    body>h1:first-of-type~ol,
    body>h1:first-of-type~blockquote,
    section.level1:first-of-type>h1:first-of-type~pre,
    section.level1:first-of-type>h1:first-of-type~table,
    section.level1:first-of-type>h1:first-of-type~figure,
    section.level1:first-of-type>h1:first-of-type~.math.display,
    section.level1:first-of-type>h1:first-of-type~.katex-display,
    section.level1:first-of-type>h1:first-of-type~.mjx-container[display="true"],
    section.level1:first-of-type>h1:first-of-type~p,
    section.level1:first-of-type>h1:first-of-type~ul,
    section.level1:first-of-type>h1:first-of-type~ol,
    section.level1:first-of-type>h1:first-of-type~blockquote {
        break-inside: avoid-page;
        page-break-inside: avoid;
        break-before: avoid-page;
        page-break-before: avoid;
    }

}

/* Print: slightly increase line-height for inline math to avoid crowding */
@media print {

    .katex:not(.katex-display),
    .mjx-container:not([display="true"]) {
        line-height: 1.5 !important;
        padding-top: 0.06em;
        padding-bottom: 0.06em;
    }

    .katex-display,
    .katex-display .katex {
        line-height: normal !important;
    }

    /* Loosen spacing for list items with inline math in print */
    li:has(.katex:not(.katex-display)),
    li:has(.mjx-container:not([display="true"])),
    li:has(.math.inline) {
        margin-top: 0.7em;
        margin-bottom: 0.7em;
    }

    .math.inline {
        line-height: 1.5 !important;
        padding-top: 0.06em;
        padding-bottom: 0.06em;
    }

    /*
     * Smart keep-with-next for headings:
     * - Keep a heading together with the first following block.
     * - If the first block cannot fit, move the heading to the next page
     *   instead of leaving it orphaned at the bottom.
     * - Exclude first H1 to avoid title page split
     */
    h1:not(:first-of-type)+*,
    h2+*,
    h3+*,
    h4+*,
    h5+*,
    h6+* {
        break-before: avoid-page;
        page-break-before: avoid;
        break-inside: avoid-page;
        page-break-inside: avoid;
    }

    /* Stronger protection for common large blocks after a heading (exclude first H1) */
    h1:not(:first-of-type)+.math.display,
    h2+.math.display,
    h3+.math.display,
    h4+.math.display,
    h5+.math.display,
    h6+.math.display,
    h1:not(:first-of-type)+.katex-display,
    h2+.katex-display,
    h3+.katex-display,
    h4+.katex-display,
    h5+.katex-display,
    h6+.katex-display,
    h1:not(:first-of-type)+.mjx-container[display="true"],
    h2+.mjx-container[display="true"],
    h3+.mjx-container[display="true"],
    h4+.mjx-container[display="true"],
    h5+.mjx-container[display="true"],
    h6+.mjx-container[display="true"],
    h1:not(:first-of-type)+pre,
    h2+pre,
    h3+pre,
    h4+pre,
    h5+pre,
    h6+pre,
    h1:not(:first-of-type)+table,
    h2+table,
    h3+table,
    h4+table,
    h5+table,
    h6+table,
    h1:not(:first-of-type)+figure,
    h2+figure,
    h3+figure,
    h4+figure,
    h5+figure,
    h6+figure,
    h1:not(:first-of-type)+ul,
    h2+ul,
    h3+ul,
    h4+ul,
    h5+ul,
    h6+ul,
    h1:not(:first-of-type)+ol,
    h2+ol,
    h3+ol,
    h4+ol,
    h5+ol,
    h6+ol {
        break-before: avoid-page;
        page-break-before: avoid;
        break-inside: avoid-page;
        page-break-inside: avoid;
    }
}
/* Print: top-priority rule — never break at headings */
@media print {

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        break-before: avoid-page;
        page-break-before: avoid;
        break-inside: avoid-page;
        page-break-inside: avoid;
    }
}

/* Print: allow TOC to split across pages (override global list rules) */
@media print {
    nav#TOC ul,
    nav#TOC ol,
    nav#TOC li,
    #TOC ul,
    #TOC ol,
    #TOC li,
    .toc ul,
    .toc ol,
    .toc li {
        break-inside: auto;
        page-break-inside: auto;
    }
}
